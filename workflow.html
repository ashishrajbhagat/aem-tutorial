<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AEM Tutorial - Workflow</title>
        <meta name="description" content="Master Adobe Experience Manager (AEM) with our in-depth tutorials, covering AEM components, workflows, servlets, models, Sling, OSGi services, Touch UI dialogs, CRXDE, and more. Perfect for beginners, advanced developers, and AEM architects looking to enhance their skills. Learn how to build scalable and efficient AEM solutions with best practices.">
        <meta name="keywords" content="AEM, Adobe Experience Manager, AEM Tutorial, AEM Training, AEM Components, AEM Workflows, AEM Servlets, AEM Models, AEM Sling, AEM OSGi, AEM Touch UI, AEM CRXDE, AEM DAM, AEM Metadata, AEM Content Fragments, AEM Experience Fragments, AEM Editable Templates, AEM Dispatcher, AEM Forms, AEM Sites, AEM Assets, AEM Cloud, AEM as a Cloud Service, AEM On-Premise, AEM SEO, AEM Best Practices, Learn AEM, AEM Course, AEM Development, AEM Headless, AEM SPA, AEM React, AEM Angular, AEM HTL, AEM Sightly, AEM Frontend, AEM Backend, AEM Workflow Development, AEM Performance Optimization, AEM Interview Questions">
        <meta name="author" content="Ashish Raj">
        <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body>
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <h2>AEM Tutorial</h2>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebarSearch" placeholder="🔍 Search..." />
            </div>
            <nav class="nav" id="sidebar-nav"></nav>
            <div class="footer">
                <p>&copy; 2025 AEM Tutorial</p>
            </div>
        </div>
        <span class="hamburger" onclick="toggleMenu()">&#9776;</span>
        <main class="content" id="content">
            <h1>Workflow</h1>
            <section class="card">
                <h2>Introduction to AEM Workflows</h2>
                <p>A workflow in AEM is a series of steps that define a process for automating tasks and content management. These steps can include human tasks and system tasks. Workflows help in managing content lifecycles efficiently. Workflows streamline business processes such as content approval, asset management, and publishing by automating tasks and routing content through different stages of approval. Workflows help in ensuring that content is reviewed, approved, and published systematically, reducing errors and improving efficiency.</p>
                <h4>Key Benefits:</h4>
                <ul>
                    <li><strong>Automation:</strong> Reduces manual efforts and speeds up content processing.</li>
                    <li><strong>Consistency:</strong> Ensures uniformity in content review and approval processes.</li>
                    <li><strong>Collaboration:</strong> Facilitates teamwork by assigning tasks to different stakeholders.</li>
                    <li><strong>Compliance:</strong> Helps in enforcing governance policies and audit trails.</li>
                    <li><strong>Improved Efficiency:</strong> Reduces errors and improves turnaround time for content publication.</li>
                </ul>
                <h4>Types of workflows:</h4>
                <p>AEM supports both basic workflows (like approval or publishing) and custom workflows, where businesses can define their own processes using workflow models, steps, and participants.</p>
            </section>
            <section class="card">
                <h2>Workflow Consoles</h2>
                <p>Workflow Consoles in Adobe Experience Manager (AEM) provide an interface for users to create, manage, and monitor workflows. These consoles help administrators and authors efficiently handle workflow-related tasks, such as starting workflows, tracking progress, and troubleshooting issues.</p>
                <h3>Overview of Workflow Consoles</h3>
                <p>AEM provides different workflow consoles to manage workflows, including the Workflow Models Console, Instances Console, and Workflow Launcher. These consoles are accessible through AEM's Touch UI and Classic UI. These are different Workflow consoles:</p>
                <h4>1. Workflow Models Console</h4>
                <p>The Workflow Models Console allows users to create and edit workflow models. A workflow model defines the sequence of steps executed when a workflow instance is started.</p>
                <ul>
                    <li><strong>Purpose:</strong> Create, modify, and manage workflow models.</li>
                    <li><strong>Access:</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/models.html</code></li>
                    <li><strong>Storage Location:</strong> <code>/var/workflow/models</code> (runtime) and <code>/apps/your-project/workflow/models</code> (version-controlled in codebase)</li>
                </ul>
                <h4>2. Workflow Instances Console</h4>
                <p>The Workflow Instances Console helps in monitoring running and completed workflow instances. It allows users to track progress, terminate workflows, or restart failed workflows.</p>
                <ul>
                    <li><strong>Purpose:</strong> View and manage active and completed workflow instances.</li>
                    <li><strong>Access:</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/instances.html</code></li>
                    <li><strong>Storage Location:</strong> <code>/var/workflow/instances</code></li>
                </ul>
                <h4>3. Workflow Launcher Console</h4>
                <p>The Workflow Launcher Console defines rules for triggering workflows automatically based on specific events, such as content modifications or asset uploads.</p>
                <ul>
                    <li><strong>Purpose:</strong> Configure automatic workflow triggers based on JCR events.</li>
                    <li><strong>Access:</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/launcher.html</code></li>
                    <li><strong>Storage Location:</strong> <code>/conf/global/settings/workflow/launchers</code> (or <code>/conf/your-project/settings/workflow/launchers</code>)</li>
                </ul>
                <h4>4. Workflow Archive Console</h4>
                <p>The Workflow Archive Console provides access to historical workflow instances. Users can review completed workflows for audit and compliance purposes.</p>
                <ul>
                    <li><strong>Purpose:</strong> Review past workflow executions.</li>
                    <li><strong>Access:</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/archive.html</code></li>
                    <li><strong>Storage Location:</strong> <code>/var/workflow/instances</code> (archived under this node)</li>
                </ul>
                <h4>5. Workflow Failure Console</h4>
                <p>The Workflow Failure Console helps users to manage and monitor workflows that have failed. It provides tools to troubleshoot and resolve issues that may have caused workflows to fail.</p>
                <ul>
                    <li><strong>Purpose:</strong> Identify and troubleshoot failed workflows.</li>
                    <li><strong>Access:</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/failures.html</code></li>
                    <li><strong>Storage Location:</strong> <code>/var/workflow/instances</code> (failed workflows are retained here until resolved or archived)</li>
                </ul>
            </section>
            <section class="card">
                <h2>Workflow Steps</h2>
                <p>Workflow Steps in Adobe Experience Manager (AEM) define the individual tasks or actions executed during the workflow process. Each step serves a distinct purpose, whether it's processing data, involving users, or controlling the workflow's flow.</p>
                <h3>Types of Workflow Steps</h3>
                <h4>1. Process Step</h4>
                <p>The Process Step is used to trigger a custom workflow action, often by executing a predefined process such as a service or a custom logic. It is typically used for tasks that require backend processing, such as content modifications or integration with external systems.</p>
                <ul>
                    <li><strong>Purpose:</strong> Execute backend processes or services during the workflow.</li>
                    <li><strong>Customization:</strong> Define custom processes or integrate external services.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor with process execution logic.</li>
                </ul>
                <h4>2. Participant Step</h4>
                <p>The Participant Step assigns tasks to one or more users or groups, where they must perform actions such as reviewing, approving, or rejecting content. It is one of the most common steps used for manual intervention in a workflow.</p>
                <ul>
                    <li><strong>Purpose:</strong> Assign tasks to specific participants (users or groups) for approval, review, or actions.</li>
                    <li><strong>Customization:</strong> Define participant users or groups, set deadlines, and specify notifications.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor.</li>
                </ul>
                <h4>3. Dialog Participant Step</h4>
                <p>The Dialog Participant Step is similar to the regular Participant Step but with the added ability for participants to complete tasks through a dialog interface. This dialog provides an intuitive user interface for users to provide input or make decisions directly within the workflow.</p>
                <ul>
                    <li><strong>Purpose:</strong> Allow participants to interact with the workflow through a dialog interface for user input.</li>
                    <li><strong>Customization:</strong> Define dialog fields and configure how users interact with the workflow.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor, utilizing AEM’s dialog components.</li>
                </ul>
                <h4>4. OR Split</h4>
                <p>The OR Split allows a workflow to branch into multiple paths, with the condition that at least one path is followed. It enables parallel or conditional execution of different workflow branches based on specific criteria.</p>
                <ul>
                    <li><strong>Purpose:</strong> Branch the workflow into multiple paths, where at least one path must be executed.</li>
                    <li><strong>Customization:</strong> Define the conditions that determine which path is followed.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor using conditional logic.</li>
                </ul>
                <h4>5. AND Split</h4>
                <p>The AND Split also branches a workflow into multiple paths, but all paths must be executed. This step ensures that every condition or branch is followed simultaneously, making it ideal for cases where all actions need to be processed in parallel.</p>
                <ul>
                    <li><strong>Purpose:</strong> Branch the workflow into multiple paths, requiring all paths to be executed.</li>
                    <li><strong>Customization:</strong> Define conditions for branching, but ensure that every branch is executed.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor.</li>
                </ul>
                <h4>6. Container Step</h4>
                <p>The Container Step groups multiple workflow steps together into a single step, allowing them to be processed as a unit. It helps in organizing complex workflows and managing related steps more efficiently.</p>
                <ul>
                    <li><strong>Purpose:</strong> Group multiple steps under one container for better organization and management.</li>
                    <li><strong>Customization:</strong> Define the steps that should be grouped into the container.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor.</li>
                </ul>
                <h4>7. GOTO Step</h4>
                <p>The GOTO Step allows the workflow to jump to another specific step, bypassing intermediate steps. It can be used for re-routing or skipping certain steps based on conditions during the workflow execution.</p>
                <ul>
                    <li><strong>Purpose:</strong> Redirect the workflow to a specified step, skipping or re-routing as needed.</li>
                    <li><strong>Customization:</strong> Define the target step to jump to and the conditions under which the jump occurs.</li>
                    <li><strong>Access:</strong> Configured in the Workflow Model Editor, allowing flexible workflow routing.</li>
                </ul>
            </section>
            <section class="card">
                <h2>Creating a Basic Workflow Model</h2>
                <h4>Steps to create</h4>
                <ul>
                    <li>Navigate to <code>Tools > Workflow > Models</code> or <code>http://localhost:4502/libs/cq/workflow/admin/console/content/models.html</code>.</li>
                    <li>Click on <code>Create</code> and define title and name.</li>
                    <li>Edit the newly created model and Add required steps such as participant or process steps.</li>
                    <li>Configure each step's properties as per requirement.</li>
                    <li>Save and activate the workflow.</li>
                </ul>
                <h4>Example: Content Approval Workflow</h4>
                <p>This workflow assigns content approval tasks to a specific user group before publishing.</p>
                <p>Follow below steps to create a model:</p>
                <ul>
                    <li>Navigate to <code>Tools > Workflow > Models</code>.</li>
                    <li>Create a new workflow model and provide a name.</li>
                    <li>
                        Open the model and add below steps in it:
                        <ul>
                            <li><em>Initiation (Optional) -</em> A starting point, like notifying the author that the workflow has been initiated.</li>
                            <li><em>Review Content (Participant Step) -</em> Add a <code>Participant Step</code> to assign the task to a manager for review and configure the participant step to assign the task to a specific user or group (e.g., <code>content-approvers</code>).</li>
                            <li><em>Publish Content (Process Step) -</em> Add a <code>Process Step</code> that automatically activates (publishes) the content if approved.</li>
                            <li><em>Notification (Optional) -</em> Add a step to send a notification to the author, informing them that the content has been published.</li>
                        </ul>
                    </li>
                    <li>Save and Activate the Workflow</li>
                </ul>
                <h4>🔄 Usage of the Sync Button</h4>
                <p>The <strong>Sync</strong> button in the AEM Workflow Model Editor is used to synchronize the edited workflow model with its runtime version. This ensures that structural changes—such as adding/removing steps or modifying branches—are applied correctly and are picked up during workflow execution.</p>
                <ul>
                    <li><strong>When to Use:</strong> After making changes to the workflow model structure but before executing it in a live environment.</li>
                    <li><strong>Where it Appears:</strong> The Sync button appears in the toolbar of the Workflow Model Editor (Touch UI).</li>
                    <li><strong>Behind the Scenes:</strong> AEM stores an editable version and a runtime version of a workflow model. Clicking Sync updates the runtime version.</li>
                </ul>
                <p><strong>Important:</strong> If you do not sync, your changes may not take effect even if the model appears updated in the UI.</p>
            </section>
            <section class="card">
                <h2>Creating a Custom Workflow Process</h2>
                <p>A custom workflow process step allows developers to introduce custom logic into workflow models. This can be achieved by implementing the <code>WorkflowProcess</code> interface and overriding its <code>execute()</code> method.</p>
                <h3>Steps to Create a Custom Workflow Process</h3>
                <h4>1. Implement the WorkflowProcess Interface</h4>
                <p>To create a custom workflow step, implement the <code>com.adobe.granite.workflow.exec.WorkflowProcess</code> interface in an OSGi component.</p>
                <pre>
@Component(service = WorkflowProcess.class, 
            property = { "process.label=Custom Workflow Step" })
public class CustomWorkflowProcess implements WorkflowProcess {

    @Override
    public void execute(WorkItem workItem, WorkflowSession workflowSession, MetaDataMap metaDataMap) 
            throws WorkflowException {
        
        // Custom logic implementation here
    }
}</pre>
                <h4>2. Understanding the <code>execute()</code> Method</h4>
                <p>The <code>execute()</code> method is called when the workflow reaches this step. It receives the following parameters:</p>
                <ul>
                    <li><strong><code>WorkItem workItem</code>:</strong> Represents the current workflow instance, providing access to payload (<em>The data on which the workflow operates, usually a page, an asset, or any other repository resource</em>) and metadata.</li>
                    <li><strong><code>WorkflowSession workflowSession</code>:</strong> Provides methods to interact with the workflow engine, such as advancing workflow steps.</li>
                    <li><strong><code>MetaDataMap metaDataMap</code>:</strong> Contains properties defined in the workflow step, including process arguments and runtime data.</li>
                </ul>
                <h5>Handling WorkflowException</h5>
                <p>The <code>execute()</code> method can throw a <code>WorkflowException</code>, which is used to handle errors that occur during workflow execution. If an exception is thrown, the workflow instance will be marked as failed.</p>
                <p>Example of handling <code>WorkflowException</code>:</p>
                <pre>
@Override
public void execute(WorkItem workItem, WorkflowSession workflowSession, MetaDataMap metaDataMap) 
        throws WorkflowException {
    try {
        String payloadPath = workItem.getWorkflowData().getPayload().toString();
        if (payloadPath == null || payloadPath.isEmpty()) {
            throw new WorkflowException("Payload path is missing in the workflow step.");
        }
    } catch (Exception e) {
        throw new WorkflowException("An error occurred in the custom workflow step: " + e.getMessage(), e);
    }
}</pre>
                <p><strong>Best Practices:</strong></p>
                <ul>
                    <li>Use <code>WorkflowException</code> to signal workflow failures instead of generic exceptions.</li>
                    <li>Log meaningful error messages for debugging.</li>
                    <li>Ensure proper handling of null values to avoid unexpected failures.</li>
                </ul>
                <h4>3. Accessing Workflow Payload</h4>
                <p>The workflow payload represents the content item the workflow is processing. It can be accessed as follows:</p>
                <pre>
String payloadPath = workItem.getWorkflowData().getPayload().toString();
ResourceResolver resourceResolver = workflowSession.adaptTo(ResourceResolver.class);
Resource resource = resourceResolver.getResource(payloadPath);</pre>
                <h4>4. Reading Process Arguments</h4>
                <p>Process arguments configured in the workflow model can be retrieved using <code>MetaDataMap</code>:</p>
                <pre>String processArgs = metaDataMap.get("PROCESS_ARGS", String.class);</pre>
                <h4>5. Logging in the Workflow Process</h4>
                <p>Logging is crucial for debugging custom workflow steps. A logger can be used as follows:</p>
                <pre>
private static final Logger LOG = LoggerFactory.getLogger(CustomWorkflowProcess.class);
            
LOG.info("Custom workflow step executed with payload: {}", payloadPath);</pre>
                <h4>6. Deploying and Using the Custom Workflow Step</h4>
                <p>Once the custom workflow step is developed and deployed, follow these steps to use it:</p>
                <ul>
                    <li>Go to <strong>Workflow Models</strong> in AEM.</li>
                    <li>Edit an existing model or create a new one.</li>
                    <li>Add a <strong>Process Step</strong> to the model.</li>
                    <li>In the step properties, select <strong>Custom Workflow Step</strong> from the available process options.</li>
                    <li>
                        If process arguments are needed:
                        <ul>
                            <li>In the <em>Arguments field</em>, enter key-value pairs, e.g., <code>{"targetPath": "/content/dam/example", "enableLogging": "true"}</code>.</li>
                            <li>The workflow step retrieves these values using <code>metaDataMap.get("PROCESS_ARGS", String.class)</code>.</li>
                            <li>Ensure that the arguments are structured correctly for proper parsing.</li>
                        </ul>
                    </li>
                    <li>Save and activate the workflow model.</li>
                </ul>
                <h4>7. Testing the Custom Workflow Step</h4>
                <p>To test the custom workflow step:</p>
                <ul>
                    <li>Start the workflow manually on a content page or asset.</li>
                    <li>Monitor the workflow execution from the <strong>Workflow Instances Console</strong>.</li>
                    <li>Check AEM logs for debug information.</li>
                </ul>
            </section>
            <section class="card">
                <h2>Creating a Process Step using ECMA Script</h2>
                <p>AEM allows the use of <strong>ECMA Scripts</strong> in workflows to add custom logic to process steps without needing Java development. This provides a lightweight alternative for modifying workflow behavior.</p>
                <h3>1. Steps to Create a Process Step using ECMA Script</h3>
                <h4>Step 1: Create a Workflow Model</h4>
                <ol>
                    <li>Navigate to <strong>AEM Start → Tools → Workflow → Models</strong>.</li>
                    <li>Create a new workflow model or edit an existing one.</li>
                    <li>Drag and drop a <strong>Process Step</strong> into the workflow.</li>
                </ol>
                <h4>Step 2: Add an ECMA Script to the Process Step</h4>
                <ol>
                    <li>Open the properties of the Process Step.</li>
                    <li>In the <strong>Process</strong> tab:</li>
                    <ul>
                        <li>Set <strong>Process Type</strong> to <code>&lt;ECMA Script&gt;</code>.</li>
                        <li>Click <strong>Create New Script</strong> or select an existing one.</li>
                    </ul>
                </ol>
                <h4>Step 3: Write an ECMA Script</h4>
                <p>The script interacts with workflow objects like <code>workItem</code>, <code>workflowSession</code>, and <code>workflowData</code>.</p>
                <ol>
                    <li>Create the script and save it in the repository at <code>/apps/&lt;project-name&gt;/workflow/scripts/</code></li>
                    <li>
                        To specify a title that identifies the script in the Process Step edit dialog, add the following properties to the <code>jcr:content</code> node of your script:
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>jcr:mixinTypes</code></td>
                                        <td>Name[]</td>
                                        <td>mix:title</td>
                                    </tr>
                                    <tr>
                                        <td><code>jcr:title</code></td>
                                        <td>String</td>
                                        <td>The name to appear in the edit dialog.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li>Edit the Process Step instance and specify the script to be used.</li>
                </ol>
                <p><strong><em>Example:</em></strong> <code>/apps/your-project/workflow/scripts/custom-process-step.ecma</code></p>
                <pre>
var workflowData = graniteWorkItem.getWorkflowData();
if (workflowData.getPayloadType() == "JCR_PATH") {
    var path = workflowData.getPayload().toString();
    var jcrsession = graniteWorkflowSession.adaptTo(Packages.javax.jcr.Session);
    var node = jcrsession.getNode(path);
    //Custom code - some action on the node..
}</pre>
                <h3>When to Use ECMA Scripts?</h3>
                <ul>
                    <li>Quick customization without Java deployment.</li>
                    <li>Simple metadata updates and workflow decision-making.</li>
                    <li>Logging and debugging workflow execution.</li>
                </ul>
                <h3>Understanding Key Objects in Java class vs ECMA Scripts</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Java Class</th>
                                <th>Script object name</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>com.adobe.granite.workflow.exec.WorkItem</code></td>
                                <td><code>graniteWorkItem</code></td>
                                <td>Represents the current workflow step being executed.</td>
                            </tr>
                            <tr>
                                <td><code>com.adobe.granite.workflow.WorkflowSession</code></td>
                                <td><code>graniteWorkflowSession</code></td>
                                <td>The workflow session of the current step instance.</td>
                            </tr>
                            <tr>
                                <td><code>String[] (contains process arguments)</code></td>
                                <td><code>args</code></td>
                                <td>Holds arguments configured in the workflow model for the process step.</td>
                            </tr>
                            <tr>
                                <td><code>com.adobe.granite.workflow.metadata.MetaDataMap</code></td>
                                <td><code>metaData</code></td>
                                <td>The meta data of the current step instance.</td>
                            </tr>
                            <tr>
                                <td><code>org.apache.sling.scripting.core.impl.InternalScriptHelper</code></td>
                                <td><code>sling</code></td>
                                <td>Provides access to the Sling runtime environment.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p><strong>Note:</strong> For complex logic, it's recommended to use <strong>Java-based Workflow Process Steps</strong>.</p>
            </section>
            <section class="card">
                <h2>Dynamic Participant Step</h2>
                <p>The <strong>Dynamic Participant Step</strong> is a workflow step that dynamically assigns a participant (user or group) based on custom logic. Unlike the standard <strong>Participant Step</strong>, which assigns tasks to predefined users or groups, the Dynamic Participant Step determines the assignee at runtime.</p>
                <h3>Steps to Create a Dynamic Participant Step</h3>
                <h4>1. Implement the ParticipantStepChooser interface</h4>
                <p>To create a Dynamic Participant Step, implement the <code>com.adobe.granite.workflow.exec.ParticipantStepChooser</code> interface and override the <code>getParticipant</code> method.</p>
                <pre>
package com.example.core.workflow;

import com.adobe.granite.workflow.exec.WorkItem;
import com.adobe.granite.workflow.exec.WorkflowSession;
import com.adobe.granite.workflow.exec.ParticipantStepChooser;
import com.adobe.granite.workflow.metadata.MetaDataMap;
import org.osgi.service.component.annotations.Component;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Component(service = ParticipantStepChooser.class, property = {"chooser.label=Custom Dynamic Participant Step"})
public class CustomDynamicParticipantStep implements ParticipantStepChooser {

    private static final Logger LOG = LoggerFactory.getLogger(CustomDynamicParticipantStep.class);

    @Override
    public String getParticipant(WorkItem workItem, WorkflowSession workflowSession, MetaDataMap metaDataMap) {
        LOG.info("Executing Dynamic Participant Step...");
        String payloadType = workItem.getWorkflowData().getPayloadType();

        // Example: Assign user based on workflow metadata
        String assignedUser = workItem.getWorkflowData().getMetaDataMap().get("assignedUser", String.class);

        if (assignedUser == null || assignedUser.isEmpty()) {
            assignedUser = "admin"; // Default fallback user
        }

        LOG.info("Assigning workflow task to user: {}", assignedUser);
        return assignedUser;
    }
}</pre>
                <h4>2. Understanding the <code>getParticipant</code> Method</h4>
                <p>The <code>getParticipant</code> method receives two parameters:</p>
                <ul>
                    <li><code>WorkItem workItem</code>: Provides details about the workflow instance and payload.</li>
                    <li><code>WorkflowSession workflowSession</code>: Provides access to workflow-related services.</li>
                    <li><code>MetaDataMap metaDataMap</code>: Provides properties defined in the workflow step.</li>
                </ul>
                <p>The method should return the <strong>user ID</strong> or <strong>group name</strong> to which the workflow step should be assigned.</p>
                <h4>3. Deploying and Using the Dynamic Participant Step</h4>
                <p>After deploying the custom Dynamic Participant Step, follow these steps to use it in a workflow:</p>
                <ul>
                    <li>Go to <strong>AEM Start</strong> -> <strong>Tools</strong> -> <strong>Workflow</strong> -> <strong>Models</strong>.</li>
                    <li>Edit an existing workflow model or create a new one.</li>
                    <li>Add a <strong>Participant Step</strong> to the workflow.</li>
                    <li>
                        In the step properties:
                        <ul>
                            <li>Set <strong>Type</strong> to <code>Dynamic Participant Step</code>.</li>
                            <li>Choose <strong>Custom Dynamic Participant Step</strong> from the dropdown.</li>
                        </ul>
                    </li>
                    <li>Save and activate the workflow model.</li>
                    <li>Start the workflow and check logs to verify execution.</li>
                </ul>
                <h4>Example Use Cases</h4>
                <ul>
                    <li>Assigning a workflow step based on content properties (e.g., content owner).</li>
                    <li>Routing approvals to different users based on document type.</li>
                    <li>Assigning tasks based on load balancing logic.</li>
                </ul>
                <h3>Participant Step vs. Dynamic Participant Step</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Participant Step</th>
                                <th>Dynamic Participant Step</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Assignment Type</td>
                                <td>Predefined user or group</td>
                                <td>Determined dynamically at runtime</td>
                            </tr>
                            <tr>
                                <td>Configuration</td>
                                <td>Set manually in workflow model</td>
                                <td>Implemented using Java logic</td>
                            </tr>
                            <tr>
                                <td>Flexibility</td>
                                <td>Limited to predefined users/groups</td>
                                <td>Can be based on metadata, business rules, or custom logic</td>
                            </tr>
                            <tr>
                                <td>Use Case</td>
                                <td>Simple user assignments</td>
                                <td>Assign users dynamically based on workflow data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <section class="card">
                <h2>Ways to Trigger a Workflow Model in AEM</h2>
                <p>In Adobe Experience Manager (AEM), workflows can be triggered in various ways to streamline processes. The main methods for triggering workflow models are through the Workflow Launcher, using the Workflow API, or manually via the AEM interface.</p>
                <h3>Main Ways to Trigger a Workflow Model</h3>
                <h4>1. Using Workflow Launcher</h4>
                <p>The Workflow Launcher is a powerful feature in AEM that allows workflows to be triggered automatically based on predefined rules or events. It listens for specific actions such as content creation, modification, or asset uploads in the AEM repository and triggers workflows without manual intervention.</p>
                <ul>
                    <li><strong>Purpose:</strong> Automatically trigger workflows based on specific content-related events like creation, modification, or asset upload.</li>
                    <li><strong>Customization:</strong> You can define custom rules in the Workflow Launcher to trigger workflows for specific events.</li>
                    <li><strong>Access:</strong> Workflow Launchers can be configured through the AEM Workflow Launcher console.</li>
                </ul>
                <h4>2. Using Workflow API</h4>
                <p>Workflows can also be triggered programmatically using AEM's Workflow API. This approach is useful for custom integrations, where workflows need to be triggered from external systems or backend applications.</p>
                <ul>
                    <li><strong>Purpose:</strong> Programmatically start workflows through custom Java code (inside Servlet, Sling model etc.) or API calls, integrating workflows into external systems.</li>
                    <li><strong>Customization:</strong> Developers can define custom triggers, pass parameters, and start workflows based on business logic.</li>
                    <li><strong>Access:</strong> You can use AEM's Java API (e.g., <code>WorkflowService</code>) to trigger workflows programmatically.</li>
                </ul>
                <h4>3. Manually</h4>
                <p>Workflows can be triggered manually by users from the AEM interface. This method allows users to start a workflow on specific content items as needed, providing flexibility and control over workflow execution.</p>
                <ul>
                    <li><strong>Purpose:</strong> Manually start workflows on content from the AEM interface, such as from Assets, Sites, or other content management areas.</li>
                    <li><strong>Customization:</strong> Users can choose which workflow model to execute and on which content.</li>
                    <li><strong>Access:</strong> Manually trigger workflows through the context menu in AEM's UI, such as in the Assets or Sites sections.</li>
                </ul>
            </section>
            <section class="card">
                <h2>Using Workflow Launcher</h2>
                <p>The Workflow Launcher monitors <strong>JCR node changes</strong> and automatically starts a workflow based on predefined rules. 
                    It listens for events like:
                </p>
                <ul>
                    <li>Node Created (e.g., when a new page or asset is added)</li>
                    <li>Node Modified (e.g., when an existing page is updated)</li>
                    <li>Node Removed (e.g., when a page or asset is deleted)</li>
                </ul>
                <h3>Steps to Configure a Workflow Launcher</h3>
                <h4>Step 1: Navigate to Workflow Launcher</h4>
                <ol>
                    <li>Go to <strong>AEM Start -> Tools -> Workflow -> Launchers</strong>.</li>
                    <li>The list of existing workflow launchers will be displayed.</li>
                    <li>Click the <strong>Create</strong> button to define a new launcher.</li>
                </ol>
                <h4>Step 2: Define Workflow Launcher Properties</h4>
                <p>In the new launcher configuration:</p>
                <ul>
                    <li><strong>Title:</strong> Provide a meaningful name for the launcher (e.g., "Auto Publish Workflow").</li>
                    <li><strong>Workflow Model:</strong> Select the workflow model to be triggered.</li>
                    <li><strong>Event Type:</strong> Choose from <code>Created</code>, <code>Modified</code>, or <code>Removed</code>.</li>
                    <li><strong>Path:</strong> Specify the JCR path to monitor (e.g., <code>/content/my-site</code>).</li>
                    <li><strong>Condition:</strong> Define additional conditions, such as checking a property value.</li>
                    <li><strong>Run Modes:</strong> Set specific environments where this launcher should be active (e.g., <code>author</code> or <code>publish</code>).</li>
                </ul>
                <h4>Step 3: Save and Enable the Launcher</h4>
                <ol>
                    <li>Click <strong>Save</strong> to apply the configuration.</li>
                    <li>Ensure that the launcher is <strong>enabled</strong> for it to take effect.</li>
                </ol>
                <h3>Example: Auto-Trigger Workflow on Page Creation</h3>
                <p>Suppose we want to trigger a workflow automatically whenever a new page is created under <code>/content/my-site</code>. 
                    The configuration would be:
                </p>
                <ul>
                    <li><strong>Title:</strong> Auto Page Review</li>
                    <li><strong>Workflow Model:</strong> Page Approval Workflow</li>
                    <li><strong>Event Type:</strong> Node Created</li>
                    <li><strong>Path:</strong> <code>/content/my-site</code></li>
                    <li><strong>Condition:</strong> <code>jcr:primaryType == "cq:Page"</code></li>
                    <li><strong>Run Modes:</strong> author</li>
                </ul>
                <h3>Validating Workflow Launcher Execution</h3>
                <p>After setting up the launcher, follow these steps to verify if it works correctly:</p>
                <ol>
                    <li>Create a new page under <code>/content/my-site</code>.</li>
                    <li>Check the <strong>Workflow Instances Console</strong> <code>http://localhost:4502/libs/cq/workflow/admin/console/content/instances.html</code> to see if the workflow started.</li>
                    <li>Review the workflow history and logs in <code>/crx-quickstart/logs/error.log</code>.</li>
                </ol>
                <h3>When to Use Workflow Launchers?</h3>
                <p>Workflow Launchers are ideal for:</p>
                <ul>
                    <li>Automating workflow execution based on content changes.</li>
                    <li>Ensuring content approval workflows are triggered without manual intervention.</li>
                    <li>Processing assets automatically upon upload.</li>
                </ul>
                <p><strong>Note:</strong> Excessive use of Workflow Launchers can impact performance. Ensure they are only configured for necessary paths.</p>
            </section>
            <section class="card">
                <h2>Using Workflow API</h2>
                <p>The Workflow API allows workflows to be triggered through Java servlets, OSGi services, or scheduled jobs. The key interfaces involved are:</p>
                <ul>
                    <li><strong><code>WorkflowSession</code></strong>: Handles workflow-related operations.</li>
                    <li><strong><code>WorkflowModel</code></strong>: Represents the workflow model to be executed.</li>
                    <li><strong><code>WorkflowData</code></strong>: Holds workflow-related payload (e.g., path of the content).</li>
                </ul>
                <h3>Steps to Trigger a Workflow Using the API</h3>
                <h4>Step 1: Inject Required Dependencies</h4>
                <p>To use the Workflow API, inject the necessary services in an OSGi component (Servlet or Service).</p>
                <pre>
@Reference
private WorkflowService workflowService;

@Reference
private ResourceResolverFactory resourceResolverFactory;</pre>
                <h4>Step 2: Obtain a Workflow Session</h4>
                <p>Use the <code>WorkflowService</code> to get a session:</p>
                <pre>
ResourceResolver resolver = resourceResolverFactory.getServiceResourceResolver(null);
Session session = resolver.adaptTo(Session.class);
WorkflowSession workflowSession = workflowService.getWorkflowSession(session);</pre>
                <h4>Step 3: Get the Workflow Model</h4>
                <p>Retrieve the workflow model using its path:</p>
                <pre>
String modelPath = "/var/workflow/models/approval-workflow";
WorkflowModel workflowModel = workflowSession.getModel(modelPath);</pre>
                <h4>Step 4: Define Workflow Data (Payload)</h4>
                <p>Specify the content path or asset to process:</p>
                <pre>
String payloadPath = "/content/my-site/page";
WorkflowData workflowData = workflowSession.newWorkflowData("JCR_PATH", payloadPath);</pre>
                <h4>Step 5: Start the Workflow</h4>
                <p>Trigger the workflow programmatically:</p>
                <pre>workflowSession.startWorkflow(workflowModel, workflowData);</pre>
                <h3>Example: Trigger Workflow in a Servlet</h3>
                <pre>
@Component(service = Servlet.class, 
            property = { "sling.servlet.paths=/bin/startWorkflow", "sling.servlet.methods=POST" })
public class WorkflowTriggerServlet extends SlingAllMethodsServlet {

    @Reference
    private WorkflowService workflowService;

    @Reference
    private ResourceResolverFactory resourceResolverFactory;

    @Override
    protected void doPost(SlingHttpServletRequest request, SlingHttpServletResponse response) throws IOException {
        try {
            // Get workflow session
            ResourceResolver resolver = resourceResolverFactory.getServiceResourceResolver(null);
            Session session = resolver.adaptTo(Session.class);
            WorkflowSession workflowSession = workflowService.getWorkflowSession(session);
            //WorkflowSession session = request.getResourceResolver().adaptTo(WorkflowSession.class);
            
            // Get workflow model
            String modelPath = "/var/workflow/models/approval-workflow";
            WorkflowModel workflowModel = workflowSession.getModel(modelPath);

            // Define workflow data (payload)
            String payloadPath = request.getParameter("path");
            WorkflowData workflowData = workflowSession.newWorkflowData("JCR_PATH", payloadPath);

            // Start workflow
            workflowSession.startWorkflow(workflowModel, workflowData);

            // Pass some metadata while triggering workflow
            //final Map&lt;String, Object&gt; workflowMetadata = new HashMap&lt;&gt;();
            //workflowMetadata.put("pathInfo", req.getPathInfo());
            //workflowSession.startWorkflow(workflowModel, workflowData, workflowMetadata);

            response.getWriter().write("Workflow started for: " + payloadPath);

        } catch (Exception e) {
            response.getWriter().write("Error: " + e.getMessage());
        }
    }
}</pre>
                <h3>When to Use the Workflow API?</h3>
                <p>The Workflow API is useful for:</p>
                <ul>
                    <li>Triggering workflows based on form submissions.</li>
                    <li>Automating workflows via custom business logic.</li>
                    <li>Starting workflows from external integrations.</li>
                </ul>
                <p><strong>Note:</strong> Ensure the service user has the necessary permissions to execute workflows.</p>
            </section>
            <section class="card">
                <h2>Manual Workflow Triggering</h2>
                <p>Manual workflow triggering allows an AEM author, editor, or administrator to start a workflow on selected pages, assets, or resources directly from the AEM interface.</p>
                <h3>Steps to Manually Start a Workflow</h3>
                <h4>Step 1: Navigate to the Workflow Console</h4>
                <p>To manually start a workflow, follow these steps:</p>
                <ul>
                    <li>Log in to AEM.</li>
                    <li>Go to <strong>Tools -> Workflow -> Models</strong> in the AEM Touch UI.</li>
                    <li>Alternatively, use the direct URL: <strong><code>http://localhost:4502/libs/cq/workflow/admin/console/content/models.html</code></strong></li>
                </ul>
                <h4>Step 2: Open the Workflow Start Dialog</h4>
                <p>There are two ways to start a workflow:</p>
                <ul>
                    <li><strong>For Pages:</strong> Open the Sites Console (<code>/sites.html</code>), select a page, and choose <strong>Start Workflow</strong> from the toolbar.</li>
                    <li><strong>For Assets:</strong> Open the Assets Console (<code>/assets.html</code>), select an asset, and choose <strong>Start Workflow</strong>.</li>
                </ul>
                <h4>Step 3: Choose the Workflow Model</h4>
                <p>After clicking <strong>Start Workflow</strong>, a dialog box appears:</p>
                <ul>
                    <li>Select the desired <strong>Workflow Model</strong> from the list.</li>
                    <li>Provide a title or additional metadata if required.</li>
                </ul>
                <h4>Step 4: Start the Workflow</h4>
                <p>Click the <strong>Start</strong> button to initiate the workflow.</p>
                <h3>Example: Manually Starting a Workflow on a Page</h3>
                <ol>
                    <li>Go to <strong>Sites Console</strong>: <code>/sites.html</code>.</li>
                    <li>Select a page (e.g., <code>/content/my-site/home</code>).</li>
                    <li>Click on <strong>Start Workflow</strong>.</li>
                    <li>Choose the <strong>Approval Workflow</strong> model.</li>
                    <li>Click <strong>Start</strong>.</li>
                </ol>
                <h3>When to Use Manual Workflow Triggering?</h3>
                <p>Manual workflow triggering is useful for:</p>
                <ul>
                    <li>Reviewing content before publishing.</li>
                    <li>Manually initiating approval processes.</li>
                    <li>Processing assets before making them available.</li>
                </ul>
                <p><strong>Note:</strong> Manual workflow triggering is ideal for scenarios where human intervention is required.</p>
            </section>
            <section class="card">
                <h2>Transient Workflows</h2>
                <p>Adobe Experience Manager (AEM) provides an option to create <strong>Transient Workflows</strong>, which are workflows that do not create persistent history logs in the repository. 
                    These workflows improve performance by reducing storage consumption and are useful for lightweight processes that do not require tracking.
                </p>
                <h3>What is a Transient Workflow?</h3>
                <p>A <strong>Transient Workflow</strong> is a workflow that runs without storing execution history under <code>/var/workflow/instances</code> in the JCR. Unlike regular workflows, transient workflows do not retain logs after execution, making them faster and more efficient.</p>
                <h3>When to Use Transient Workflows?</h3>
                <p>Transient workflows are useful when:</p>
                <ul>
                    <li>You do not need to track workflow execution history.</li>
                    <li>The workflow is executed frequently (e.g., automatic processing workflows).</li>
                    <li>You need better performance with minimal storage overhead.</li>
                    <li>The workflow involves lightweight operations like metadata updates.</li>
                </ul>
                <h3>How to Make a Workflow Transient?</h3>
                <p>To mark a workflow as transient, follow these steps:</p>
                <h4>Step 1: Open the Workflow Model</h4>
                <ul>
                    <li>Navigate to <strong>Tools -> Workflow -> Models</strong> in AEM.</li>
                    <li>Select the workflow model you want to modify.</li>
                    <li>Click on <strong>Edit</strong> to open the workflow editor.</li>
                </ul>
                <h4>Step 2: Enable the Transient Workflow Option</h4>
                <ul>
                    <li>Click on the <strong>Page Properties</strong> of the workflow model.</li>
                    <li>Under the <strong>Advanced</strong> tab, check the box for <strong>Transient Workflow</strong>.</li>
                    <li>Click <strong>Save & Close</strong>.</li>
                </ul>
                <h3>Implementing a Transient Workflow Using Code</h3>
                <p>You can also programmatically define a workflow as transient using a <strong>custom workflow process step</strong>:</p>
                <pre>
@Component(service = WorkflowProcess.class, 
            property = {"process.label=Custom Transient Workflow"})
public class TransientWorkflowProcess implements WorkflowProcess {

    @Override
    public void execute(WorkItem workItem, WorkflowSession workflowSession, MetaDataMap args) throws WorkflowException {
        WorkflowModel workflowModel = workItem.getWorkflow().getWorkflowModel();
        
        // Set the workflow to be transient
        workflowModel.getMetaDataMap().put("transient", true);

        log.info("Executing transient workflow process for: " + workItem.getWorkflowData().getPayload());
    }
}</pre>
                <h3>Verifying a Transient Workflow</h3>
                <p>To confirm that a workflow is transient:</p>
                <ul>
                    <li>Run the workflow on a page or asset.</li>
                    <li>Check the JCR path <code>/var/workflow/instances</code>.</li>
                    <li>If the workflow is transient, no entry will be created under this path.</li>
                </ul>
                <h3>Limitations of Transient Workflows</h3>
                <p>While transient workflows offer better performance, they have some limitations:</p>
                <ul>
                    <li>No audit trail is maintained.</li>
                    <li>Cannot be restarted if failed.</li>
                    <li>Debugging is more difficult without logs.</li>
                </ul>
                <p><strong>Note:</strong> Use transient workflows only when logging and history tracking are not required.</p>
            </section>
            <script src="https://utteranc.es/client.js" repo="ashishrajbhagat/aem-tutorial" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
        </main>
        <script src="js/script.js"></script>
    </body>
</html>