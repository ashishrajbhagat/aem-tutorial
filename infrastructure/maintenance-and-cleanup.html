<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>AEM Tutorial - Maintenance and Housekeeping</title>
        <meta name="description" content="Master Adobe Experience Manager (AEM) with our in-depth tutorials, covering AEM components, workflows, servlets, models, Sling, OSGi services, Touch UI dialogs, CRXDE, and more. Perfect for beginners, advanced developers, and AEM architects looking to enhance their skills. Learn how to build scalable and efficient AEM solutions with best practices.">
        <meta name="keywords" content="AEM, Adobe Experience Manager, AEM Tutorial, AEM Training, AEM Components, AEM Workflows, AEM Servlets, AEM Models, AEM Sling, AEM OSGi, AEM Touch UI, AEM CRXDE, AEM DAM, AEM Metadata, AEM Content Fragments, AEM Experience Fragments, AEM Editable Templates, AEM Dispatcher, AEM Forms, AEM Sites, AEM Assets, AEM Cloud, AEM as a Cloud Service, AEM On-Premise, AEM SEO, AEM Best Practices, Learn AEM, AEM Course, AEM Development, AEM Headless, AEM SPA, AEM React, AEM Angular, AEM HTL, AEM Sightly, AEM Frontend, AEM Backend, AEM Workflow Development, AEM Performance Optimization, AEM Interview Questions">
        <meta name="author" content="Ashish Raj">
		<link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="stylesheet" href="../css/styles.css">
    </head>
    <body>
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <h2><a href="/">AEM Tutorial</a></h2>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebarSearch" placeholder="ðŸ” Search..." />
            </div>
            <nav class="nav" id="sidebar-nav"></nav>
            <div class="footer">
                <p>&copy; 2025 AEM Tutorial</p>
            </div>
        </div>
        <span class="hamburger" onclick="toggleMenu()">&#9776;</span>
        <main class="content" id="content">
            <h1>Maintenance and Housekeeping</h1>
            <section class="card">
                <h2>Introduction</h2>
                <p>Regular maintenance is essential in Adobe Experience Manager (AEM) to ensure the system remains performant, scalable, and manageable over time. As your content repository grows, so does the risk of performance degradation and unnecessary storage consumption.</p>
                <h3>Why Maintenance Matters</h3>
                <ul>
                    <li>Improves system performance and response time</li>
                    <li>Prevents excessive disk usage from unused versions and assets</li>
                    <li>Reduces the chance of repository corruption or out-of-memory issues</li>
                    <li>Keeps your environment clean and secure</li>
                </ul>
                <h3>Cloud Service vs On-Prem Maintenance</h3>
                <ul>
                    <li><strong>AEM as a Cloud Service:</strong> Most maintenance tasks (compaction, cleanup, backups) are handled by Adobe. You still need to manage repository content size and user policies.</li>
                    <li><strong>AEM On-Prem/AMS:</strong> Requires manual setup and scheduling of cleanup tasks like version purging, audit log cleanup, tar compaction, etc.</li>
                </ul>
            </section>
            <section class="card">
                <h2>Repository Size Management</h2>
                <p>The size of your AEM repository can increase rapidly as you author more pages, upload assets, and enable workflows or versioning. Without regular cleanup, this can lead to poor performance, longer backup times, and system instability.</p>
                <h3>Common Causes of Growth</h3>
                <ul>
                    <li>Excessive page versioning over time</li>
                    <li>Large asset uploads and unoptimized media</li>
                    <li>Accumulation of audit logs and workflow instances under <code>/var</code></li>
                    <li>Unreferenced nodes or stale renditions</li>
                </ul>
                <h3>Monitoring Repository Size</h3>
                <ul>
                    <li>Check the size of the TarMK directory at: <code>/crx-quickstart/repository/segmentstore</code></li>
                    <li>Use JMX or AEM Web Console to monitor repository metrics</li>
                    <li>Track content growth in <code>/content</code>, <code>/var</code>, and <code>/dam</code> folders</li>
                    <li>Use external tools like <code>du -sh</code>, <code>oak-run</code>, or Adobe's Cloud Manager dashboards</li>
                </ul>
                <p><em>Pro Tip:</em> Avoid unnecessary retention of test content and unused assets in higher environments.</p>
            </section>
            <section class="card">
                <h2>Version Purge</h2>
                <p>Every time a page is modified and saved in AEM, a new version can be created. Over time, these accumulated versions can significantly increase the size of your JCR repository. Regular version purging helps keep your repository lean and optimized.</p>
                <h3>Available Tools for Version Purge</h3>
                <ul>
                    <li><strong>Touch UI:</strong> Navigate to <em>Tools â†’ Operations â†’ Maintenance</em> â†’ Run Version Purge Task</li>
                    <li><strong>Classic UI:</strong> <code>/libs/wcm/core/content/versionpurge</code></li>
                    <li><strong>JMX Console:</strong> <code>com.adobe.granite.maintenance</code></li>
                </ul>
                <h3>Configurable Rules</h3>
                <ul>
                    <li>Max number of versions per node (e.g., keep last 5)</li>
                    <li>Remove versions older than X days (e.g., 90 days)</li>
                    <li>Include or exclude specific paths</li>
                </ul>
                <h3>Best Practices</h3>
                <ul>
                    <li>Exclude paths like <code>/conf</code>, <code>/libs</code>, and <code>/apps</code> from purging</li>
                    <li>Schedule version purge during off-peak hours</li>
                    <li>Test purge settings in lower environments first</li>
                    <li>Keep at least a few recent versions for rollback safety</li>
                </ul>
            </section>
            <section class="card">
                <h2>Audit Log Cleanup</h2>
                <p>AEM stores audit records to track user actions such as logins, page modifications, and workflow events. While useful for compliance and debugging, these logs can accumulate and increase repository size over time.</p>
                <h3>How to Clean Up Audit Logs</h3>
                <ul>
                    <li><strong>JMX Console:</strong> Use MBeans under <code>com.adobe.granite.auditlog</code></li>
                    <li><strong>Scheduled Cleanup:</strong> Write a custom workflow or job that clears logs older than a set threshold</li>
                    <li><strong>Manual Script:</strong> Use repository queries to delete log nodes from <code>/var/audit</code></li>
                </ul>
                <h3>Best Practices</h3>
                <ul>
                    <li>Retain only 30-90 days of audit logs (or per your compliance policy)</li>
                    <li>Back up logs externally before deletion if needed</li>
                    <li>Automate the cleanup process on a weekly or monthly schedule</li>
                </ul>
            </section>
            <section class="card">
                <h2>Tar Compaction (On-Prem Only)</h2>
                <p>For AEM On-Prem installations using <strong>TarMK</strong>, the repository undergoes compaction to optimize storage. This helps reduce disk usage and prevents repository fragmentation.</p>
                <h3>Types of Compaction</h3>
                <ul>
                    <li><strong>Online (Background) Compaction:</strong> Runs automatically based on repository activity and config</li>
                    <li><strong>Offline Compaction:</strong> Manual compaction using <code>oak-run</code> while AEM is stopped</li>
                </ul>
                <h3>Compaction Tools</h3>
                <ul>
                    <li><strong>JMX Console:</strong> <code>org.apache.jackrabbit.oak:name=TarMK</code> bean</li>
                    <li><strong>oak-run:</strong> Command-line tool used to compact and analyze repositories offline</li>
                </ul>
                <h3>Tips & Best Practices</h3>
                <ul>
                    <li>Schedule compaction during maintenance windows to avoid performance issues</li>
                    <li>Always take a backup before offline compaction</li>
                    <li>Monitor logs for compaction progress and potential issues</li>
                </ul>
                <div><strong>Note:</strong> AEM as a Cloud Service handles compaction automaticallyâ€”no action needed for AEMaaCS users.</div>
            </section>
            <section class="card">
                <h2>DAM Rendition Cleanup</h2>
                <p>When assets such as images and videos are uploaded to AEM, multiple renditions (e.g., thumbnails, resized images) are generated automatically. Over time, these renditions can consume significant disk space.</p>
                <h3>Tools for Rendition Cleanup</h3>
                <ul>
                    <li><strong>ACS Commons DAM Rendition Cleaner:</strong> Provides an interface and scheduler to remove unnecessary renditions across the DAM.</li>
                    <li><strong>Custom Scripts:</strong> Groovy or Java-based scripts can be written to target specific renditions or folders.</li>
                </ul>
                <h3>Use Cases</h3>
                <ul>
                    <li>Remove unused or rarely accessed renditions</li>
                    <li>Reclaim storage in image-heavy environments</li>
                    <li>Delete custom renditions that are no longer needed</li>
                </ul>
            </section>
            <section class="card">
                <h2>Deactivating Unused Users</h2>
                <p>Inactive or orphaned user accounts pose a security risk. Regularly reviewing and disabling unused accounts helps maintain security and compliance.</p>
                <h3>How to Deactivate Users</h3>
                <ul>
                    <li><strong>Touch UI:</strong> Go to <em>Tools â†’ Security â†’ Users</em>, locate the user, and disable their account</li>
                    <li><strong>Programmatically:</strong> Set <code>rep:disabled</code> or an expiration date on the user node via code or script</li>
                    <li><strong>LDAP Integration:</strong> Configure LDAP synchronization to automatically disable or remove users not found in the directory</li>
                </ul>
                <p><em>Tip:</em> Audit user activity and login timestamps to identify unused accounts.</p>
            </section>
            <section class="card">
                <h2>Monitoring for Growth</h2>
                <p>It's essential to keep track of your repository and asset growth to proactively manage performance and storage limits.</p>
                <h3>Tools for Monitoring</h3>
                <ul>
                    <li><strong>JMX Console:</strong> <code>/system/console/jmx</code> offers live metrics on repository state</li>
                    <li><strong>CRXDE:</strong> <code>/crx/de/index.jsp</code> provides an overview of node sizes and structure</li>
                    <li><strong>Third-Party Monitoring:</strong> Tools like Sling Metrics, Datadog, New Relic, or Adobe's Cloud Manager Insights</li>
                </ul>
                <h3>Recommended Metrics to Track</h3>
                <ul>
                    <li>Size and growth of <code>/content</code>, <code>/dam</code>, and <code>/var</code></li>
                    <li>Number of nodes and assets</li>
                    <li>Frequency of workflow executions and job queues</li>
                </ul>
                <p><em>Pro Tip:</em> Automate alerts when thresholds are breached using monitoring dashboards or log watchers.</p>
            </section>
            <section class="card">
                <h2>Best Practices</h2>
                <ul>
                    <li><strong>Automate routine cleanup tasks</strong> using OSGi schedulers, ACS Commons jobs, or workflows</li>
                    <li><strong>Establish and enforce retention policies</strong> for content versions, audit logs, and user accounts</li>
                    <li><strong>Document cleanup scripts</strong> and version them via Git or other VCS tools</li>
                    <li><strong>Always test maintenance routines</strong> on lower environments before running in production</li>
                    <li><strong>Use <code>oak-run</code></strong> only when AEM is stopped and a full backup is available</li>
                    <li>Schedule major maintenance (e.g., offline compaction) during low-traffic windows</li>
                </ul>
            </section>
            <script src="https://utteranc.es/client.js" repo="ashishrajbhagat/aem-tutorial" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
        </main>
        <script src="../js/script.js"></script>
    </body>
</html>
